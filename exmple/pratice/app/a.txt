Building the API layer that exposes your repository methods using Next.js App Router.

âœ… Goal

Build app/api/vehicles/... routes.
Use try...catch to:
Return error messages from repositories.
Set correct status codes (e.g. 200, 400, 404).
âœ… File Structure

app/
â””â”€â”€ api/
    â””â”€â”€ vehicles/
        â”œâ”€â”€ route.js                         â† GET all + POST vehicle
        â””â”€â”€ [id]/
            â”œâ”€â”€ violations/
            â”‚   â”œâ”€â”€ route.js                 â† GET/POST violation
            â”‚   â””â”€â”€ [vid]/
            â”‚       â””â”€â”€ route.js             â† PATCH/DELETE violation
âœ… Step-by-Step API Implementation

cd app
ğŸ”¹ Step 2: Create the api/vehicles folder
mkdir -p api/vehicles
ğŸ”¹ Step 3: Go into vehicles and create the main route.js file
cd api/vehicles
touch route.js
âœ… This file is for:

GET /api/vehicles â†’ Get all vehicles
POST /api/vehicles â†’ Add a vehicle
ğŸ”¹ Step 4: Create dynamic route for vehicle ID + violations
mkdir -p [id]/violations
cd [id]/violations
touch route.js
âœ… This file is for:

POST /api/vehicles/:id/violations â†’ Add a violation to a vehicle
ğŸ”¹ Step 5: Create nested route for specific violation ID
mkdir -p "[id]/violations"
cd "[id]/violations"
touch route.js

âœ… This file is for:

PATCH /api/vehicles/:id/violations/:vid â†’ Update violation
DELETE /api/vehicles/:id/violations/:vid â†’ Delete violation



ğŸ”¹ 1. app/api/vehicles/route.js
import { getVehicles, createVehicle } from "@/repos/vehicles"
import { NextResponse } from "next/server"

export async function GET() {
  try {
    const vehicles = await getVehicles()
    return NextResponse.json(vehicles, { status: 200 })
  } catch (e) {
    return NextResponse.json({ error: e.message }, { status: 500 })
  }
}

export async function POST(request) {
  try {
    const body = await request.json()
    const vehicle = await createVehicle(body)
    return NextResponse.json(vehicle, { status: 201 })
  } catch (e) {
    return NextResponse.json({ error: e.message }, { status: 400 })
  }
}
ğŸ”¹ 2. app/api/vehicles/[id]/violations/route.js
import { addViolation } from "@/repos/violations"
import { NextResponse } from "next/server"

export async function POST(request, { params }) {
  try {
    const data = await request.json()
    const { id } = params

    const violation = await addViolation(id, data)
    return NextResponse.json(violation, { status: 201 })
  } catch (e) {
    return NextResponse.json({ error: e.message }, { status: 400 })
  }
}
ğŸ”¹ 3. app/api/vehicles/[id]/violations/[vid]/route.js
import { updateViolation, deleteViolation } from "@/repos/violations"
import { NextResponse } from "next/server"

export async function PATCH(request, { params }) {
  try {
    const { id, vid } = params
    const data = await request.json()

    const updated = await updateViolation(id, vid, data)
    return NextResponse.json(updated, { status: 200 })
  } catch (e) {
    return NextResponse.json({ error: e.message }, { status: 400 })
  }
}

export async function DELETE(request, { params }) {
  try {
    const { id, vid } = params

    const deleted = await deleteViolation(id, vid)
    return NextResponse.json(deleted, { status: 200 })
  } catch (e) {
    const status = e.message.includes("unpaid") ? 403 : 400
    return NextResponse.json({ error: e.message }, { status })
  }
}
âœ… Endpoints Summary (with HTTP status codes)

Method	Route	Action	Status Codes
GET	/api/vehicles	List all vehicles	200, 500
POST	/api/vehicles	Create a vehicle	201, 400
POST	/api/vehicles/:id/violations	Add violation	201, 400
PATCH	/api/vehicles/:id/violations/:vid	Update violation (e.g., paid)	200, 400
DELETE	/api/vehicles/:id/violations/:vid	Delete paid violation	200, 403, 400
